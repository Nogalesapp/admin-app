(this["webpackJsonpnogales-admin"]=this["webpackJsonpnogales-admin"]||[]).push([[0],{32:function(e,t,a){e.exports=a(64)},37:function(e,t,a){},42:function(e,t,a){},64:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(13),i=a.n(r),o=(a(37),a(29)),l=a(7),c=a(14),d=a(15),u=a(17),m=a(16),p=a(18),g=a(8),h=a.n(g);a(26);function f(){return"undefined"!==typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}var v=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).login=function(e){e.preventDefault();var t="Realizando Login ...";a.setState({fetching:!0,error:t}),h.a.auth().signInWithEmailAndPassword(a.state.email,a.state.password).then((function(e){a.props.history.push("/map")}),(function(e){t="auth/user-not-found"===e.code?"Usuario no encontrado":"Contrase\xf1a incorrecta",a.setState({fetching:!1,error:t})}))},h.a.apps.length||(a.app=h.a.initializeApp({apiKey:"AIzaSyBkRMV8HV4cazNztL2t5KAQ-QJKw1ch_Ug",authDomain:"nogalesapp-1.firebaseapp.com",databaseURL:"https://nogalesapp-1.firebaseio.com",projectId:"nogalesapp-1",storageBucket:"nogalesapp-1.appspot.com",messagingSenderId:"235008508187",appId:"1:235008508187:web:44833208e4bb535479d3be"})),a.state={fetching:!1,error:"",email:"",password:""},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("div",{className:"navbar navbar-dark bg-dark",style:{display:"flex",justifyContent:f()?"":"center",paddingTop:20,paddingBottom:20}},s.a.createElement("img",{src:window.location.origin+"/admin-app/assets/Nogales.png",height:f()?30:"100%",className:"img-responsive",alt:"Logo"})),s.a.createElement("div",{className:"mt-3 pt-3",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},s.a.createElement("b",{className:"mb-4"},"Para ingresar al sistema, inicie sesi\xf3n."),s.a.createElement("hr",null),s.a.createElement("form",{onSubmit:this.login,style:{width:"50%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},s.a.createElement("div",{className:"form-group",style:{width:"100%"}},s.a.createElement("input",{value:this.state.email,onChange:function(t){return e.setState({email:t.target.value})},type:"email",className:"form-control",id:"exampleInputEmail1","aria-describedby":"emailHelp",placeholder:"Ingrese correo electr\xf3nico",required:!0})),s.a.createElement("div",{className:"form-group",style:{width:"100%"}},s.a.createElement("input",{value:this.state.password,onChange:function(t){return e.setState({password:t.target.value})},type:"password",className:"form-control",id:"exampleInputPassword1",placeholder:"Contrase\xf1a",required:!0})),s.a.createElement("button",{onClick:this.login,type:"submit",className:"btn btn-secondary btn-lg btn-block"},"Ingresar"),s.a.createElement("p",{className:"mt-3",style:{alignSelf:"flex-end",color:this.state.fetching?"black":"red"}},this.state.error))))}}]),t}(n.Component),b=(a(42),a(43),a(10)),E=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).displayMarkers=function(){return a.state.stores.map((function(e,t){return s.a.createElement(b.Marker,{key:t,id:t,title:"Hi",name:e.time,position:{lat:e.latitude,lng:e.longitude},onClick:a.onMarkerClick})}))},a.onMarkerClick=function(e,t,n){return a.setState({selectedPlace:e,activeMarker:t,showingInfoWindow:!0})},a.handleDateSelection=function(e){return a.setState({selectedDate:e.target.value})},a.firestore=null;var n=new Date;n.setHours(0,0,0),a.beginningDateObject=n;try{h.a.auth().currentUser||a.props.replace("/",""),a.firestore=h.a.firestore()}catch(r){a.props.history.replace("/","")}return a.state={stores:[],locations:[],selectedBusId:-1,buses:[{id:"Cp3arit19GVGsKMVhxew",name:"Bus 1"},{id:"PcSUAY7w4p3nXfP9MLyf",name:"Bus 2"},{id:"ql9zKGWuOZtCRJncfaIL",name:"Bus 3"},{id:"test",name:"TEST"}],selectedPlace:"",activeMarker:null,showingInfoWindow:!1,distance:"--",selectedBus:null,dates:[],selectedDate:0},a}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){for(var e=[],t=0;t<5;t++){var a=new Date;a.setDate(this.beginningDateObject.getDate()-t),a.setHours(0,0,1),e.push(a)}this.setState({dates:e})}},{key:"deleteOldDates",value:function(e){var t=this.firestore.batch();this.firestore.collection("server").doc(e.id).collection("tracking").where("CreatedAt","<=",this.state.dates[4]).orderBy("CreatedAt").get().then((function(e){e.forEach((function(e){t.delete(e.ref)})),t.commit().then((function(e){}))}))}},{key:"getMarkers",value:function(e){var t=this;this.setState({selectedBusId:e.id});var a=[],n=new window.google.maps.LatLngBounds,s=[];this.deleteOldDates(e);var r=0,i=new Date;i.setDate(this.state.dates[this.state.selectedDate].getDate()),i.setHours(23,59,59,999),this.firestore.collection("server").doc(e.id).collection("tracking").where("CreatedAt",">",this.state.dates[this.state.selectedDate]).where("CreatedAt","<",i).orderBy("CreatedAt").get().then((function(e){e.forEach((function(e){r+=.025;var t=e.data();console.log(t);var i=new Date(0);i.setUTCSeconds(t.CreatedAt.seconds);var o="".concat(i.getHours(),":").concat(i.getMinutes());a.push({latitude:t.latitud,longitude:t.longitud,time:o}),n.extend(new window.google.maps.LatLng(t.latitud,t.longitud)),s.push({lat:t.latitud,lng:t.longitud})})),t.setState({stores:a,locations:s,distance:r.toString()},(function(){}))}))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("div",{className:"navbar navbar-dark bg-dark",style:{display:"flex",paddingTop:20,alignItems:"center",paddingBottom:20}},s.a.createElement("img",{src:"/admin-app/assets/Nogales.png",height:f()?30:"100%",alt:"Logo"}),s.a.createElement("div",{onClick:function(){h.a.auth().signOut().then((function(){e.props.history.replace("/","")}))},className:"btn btn-outline-success my-2 my-sm-0"},"Salir")),s.a.createElement("div",{className:"container mt-3"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col-md-3"},s.a.createElement("div",{className:"card p-3"},s.a.createElement("h4",{className:"mb-3"},"Camiones de basura"),s.a.createElement("br",null),s.a.createElement("select",{className:"form-group",value:this.state.selectedDate,onChange:this.handleDateSelection},this.state.dates?this.state.dates.map((function(e,t){return s.a.createElement("option",{value:t},"".concat(e.getDate(),"-").concat(e.getMonth()+1,"-").concat(e.getFullYear()))})):null),s.a.createElement("br",null),s.a.createElement("h2",null,"Reporte del d\xeda"),s.a.createElement("div",{className:"list-group"},this.state.buses.map((function(t){return s.a.createElement("div",{className:t.id===e.state.selectedBusId?"list-group-item active":"list-group-item",style:{cursor:"pointer"},onClick:function(){return e.getMarkers(t)}},t.name)}))),s.a.createElement("div",{className:"mt-3 p-3 card"},s.a.createElement("strong",{className:"text-center"},"Distancia recorrida"),s.a.createElement("strong",{className:"mt-3 text-center"},this.state.distance," KM")))),s.a.createElement("div",{className:"col-md-9"},s.a.createElement(b.Map,{google:this.props.google,zoom:14,style:{width:"100%",height:500,overFlow:"hidden",marginRight:0},ref:function(t){return e.map=t},initialCenter:{lat:18.8157483,lng:-97.1640488}},this.displayMarkers(),s.a.createElement(b.InfoWindow,{marker:this.state.activeMarker,visible:this.state.showingInfoWindow},s.a.createElement("div",null,s.a.createElement("p",null,this.state.selectedPlace.name))),this.state.locations?s.a.createElement(b.Polyline,{path:this.state.locations,strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2}):null)))))}}]),t}(n.Component);E=Object(b.GoogleApiWrapper)({apiKey:"AIzaSyCls2n588WAf6AHLWYU69MKcPWKYrMfJcI",language:"ES"})(E);var w=s.a.createElement(o.a,{basename:"/"},s.a.createElement(l.c,null,s.a.createElement(l.a,{exact:!0,path:"/",component:v}),s.a.createElement(l.a,{path:"/map",component:E})));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(w,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[32,1,2]]]);
//# sourceMappingURL=main.3db1656a.chunk.js.map